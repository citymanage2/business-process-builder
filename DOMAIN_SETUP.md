# Инструкция по подключению домена с reg.ru

Данное руководство описывает процесс подключения собственного домена зарегистрированного на reg.ru к веб-приложению Business Process Builder.

## Варианты размещения приложения

Существует два основных сценария подключения домена в зависимости от того где размещено ваше приложение.

### Вариант 1: Приложение на платформе Manus

Если вы используете платформу Manus для хостинга приложения процесс подключения домена максимально упрощен через встроенный интерфейс управления.

#### Шаг 1: Получение целевого адреса

Откройте Management UI вашего проекта на платформе Manus. В правом верхнем углу нажмите на иконку настроек чтобы открыть панель управления. Перейдите в раздел **Settings → Domains** где будет указан текущий автоматически сгенерированный домен вида `xxx.manus.space`.

В этом разделе вы увидите инструкции по подключению собственного домена включая CNAME запись которую необходимо добавить в DNS настройки вашего домена.

#### Шаг 2: Настройка DNS на reg.ru

Войдите в личный кабинет reg.ru по адресу https://www.reg.ru используя ваши учетные данные. После авторизации перейдите в раздел **Домены** в главном меню и найдите домен который вы хотите подключить к приложению.

Нажмите на название домена чтобы открыть страницу управления затем выберите вкладку **Управление доменом** и найдите раздел **DNS-серверы и зона**. Нажмите кнопку **Изменить зону** чтобы открыть редактор DNS записей.

#### Шаг 3: Добавление CNAME записи

В редакторе DNS зоны нажмите кнопку **Добавить запись** и выберите тип записи **CNAME**. В поле **Субдомен** введите имя поддомена который вы хотите использовать (например `app` для адреса app.yourdomain.ru) или оставьте символ `@` если хотите использовать корневой домен.

В поле **Каноническое имя** введите адрес предоставленный платформой Manus (обычно это ваш текущий домен вида `xxx.manus.space`). Убедитесь что в конце адреса стоит точка как требуется синтаксисом DNS записей.

Установите TTL (время жизни записи) на значение 3600 секунд (1 час) или оставьте значение по умолчанию. Нажмите кнопку **Добавить** чтобы сохранить запись.

#### Шаг 4: Регистрация домена на платформе Manus

Вернитесь в Management UI вашего проекта на платформе Manus в раздел **Settings → Domains**. В поле для ввода собственного домена введите полный адрес который вы настроили в DNS (например `app.yourdomain.ru`) и нажмите кнопку **Добавить домен** или **Привязать домен**.

Платформа автоматически проверит DNS записи и если все настроено корректно начнет процесс выпуска SSL сертификата через Let's Encrypt. Этот процесс обычно занимает от нескольких минут до часа.

#### Шаг 5: Проверка работы

После того как платформа подтвердит успешное подключение домена откройте ваш домен в браузере чтобы убедиться что приложение доступно. Проверьте что соединение защищено (в адресной строке должен отображаться замок) что означает успешную установку SSL сертификата.

Если домен не открывается сразу подождите несколько минут так как DNS записи могут распространяться по сети с задержкой до 24 часов хотя обычно это происходит в течение 15-30 минут.

### Вариант 2: Самостоятельный хостинг на VPS/сервере

Если вы размещаете приложение на собственном сервере или VPS процесс подключения домена требует дополнительных шагов по настройке веб-сервера и SSL сертификатов.

#### Шаг 1: Подготовка сервера

Убедитесь что ваше приложение запущено на сервере и доступно локально на определенном порту (обычно 3000 для Node.js приложений). Установите веб-сервер nginx или Apache для проксирования запросов к вашему приложению.

Для установки nginx на Ubuntu/Debian выполните команды:

```bash
sudo apt update
sudo apt install nginx
```

Для CentOS/RHEL используйте:

```bash
sudo yum install nginx
```

#### Шаг 2: Настройка DNS на reg.ru

Войдите в личный кабинет reg.ru и перейдите к управлению вашим доменом как описано в Варианте 1. Вместо CNAME записи вам нужно создать **A-запись** которая указывает на IP адрес вашего сервера.

Нажмите **Добавить запись** и выберите тип **A**. В поле **Субдомен** введите `@` для корневого домена или имя поддомена (например `app`). В поле **IP адрес** введите публичный IP адрес вашего сервера.

Если вы хотите чтобы домен работал как с www так и без него создайте две записи: одну для `@` и одну для `www` обе указывающие на один IP адрес. Сохраните изменения.

#### Шаг 3: Настройка nginx

Создайте конфигурационный файл для вашего домена в директории `/etc/nginx/sites-available/`:

```bash
sudo nano /etc/nginx/sites-available/yourdomain.ru
```

Добавьте следующую конфигурацию заменив `yourdomain.ru` на ваш домен и `3000` на порт вашего приложения:

```nginx
server {
    listen 80;
    listen [::]:80;
    server_name yourdomain.ru www.yourdomain.ru;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

Создайте символическую ссылку для активации конфигурации:

```bash
sudo ln -s /etc/nginx/sites-available/yourdomain.ru /etc/nginx/sites-enabled/
```

Проверьте конфигурацию на ошибки:

```bash
sudo nginx -t
```

Если проверка прошла успешно перезапустите nginx:

```bash
sudo systemctl restart nginx
```

#### Шаг 4: Установка SSL сертификата

Для защищенного HTTPS соединения установите бесплатный SSL сертификат от Let's Encrypt используя certbot.

Установите certbot:

```bash
# Ubuntu/Debian
sudo apt install certbot python3-certbot-nginx

# CentOS/RHEL
sudo yum install certbot python3-certbot-nginx
```

Запустите процесс получения и установки сертификата:

```bash
sudo certbot --nginx -d yourdomain.ru -d www.yourdomain.ru
```

Certbot автоматически обнаружит конфигурацию nginx получит сертификат и настроит автоматическое перенаправление с HTTP на HTTPS. Следуйте инструкциям на экране вводя ваш email для уведомлений о истечении сертификата.

#### Шаг 5: Настройка автоматического обновления сертификата

SSL сертификаты Let's Encrypt действительны 90 дней но certbot автоматически настраивает задачу для обновления. Проверьте что автоматическое обновление работает:

```bash
sudo certbot renew --dry-run
```

Если команда выполнилась без ошибок обновление будет происходить автоматически через systemd timer или cron.

#### Шаг 6: Настройка переменных окружения

Убедитесь что в файле `.env` вашего приложения указаны корректные значения для production окружения. Особенно важно установить правильный `VITE_APP_TITLE` и другие публичные переменные которые будут использоваться в production.

Если вы используете process manager вроде PM2 для управления Node.js приложением настройте его для автоматического запуска при перезагрузке сервера:

```bash
pm2 startup
pm2 save
```

#### Шаг 7: Проверка работы

Откройте ваш домен в браузере используя HTTPS протокол (например `https://yourdomain.ru`). Убедитесь что:

- Приложение загружается корректно
- SSL сертификат валиден (замок в адресной строке)
- HTTP запросы автоматически перенаправляются на HTTPS
- Все функции приложения работают как ожидается

## Распространенные проблемы и решения

### DNS записи не применяются

DNS изменения могут распространяться по сети от нескольких минут до 24-48 часов в зависимости от TTL значений и DNS провайдеров. Вы можете проверить текущее состояние DNS записей используя онлайн инструменты вроде https://www.whatsmydns.net или команду `nslookup`:

```bash
nslookup yourdomain.ru
```

Если запись не обновляется в течение нескольких часов проверьте что вы правильно ввели все данные в панели управления reg.ru и что изменения были сохранены.

### Ошибка "Too many redirects"

Эта ошибка обычно возникает когда nginx неправильно обрабатывает заголовки прокси. Убедитесь что в конфигурации nginx присутствует строка:

```nginx
proxy_set_header X-Forwarded-Proto $scheme;
```

Также проверьте что ваше приложение не пытается самостоятельно выполнять редирект на HTTPS когда уже получает HTTPS запросы через прокси.

### Приложение недоступно после настройки

Проверьте что:

- Node.js приложение запущено и слушает на правильном порту
- Firewall на сервере разрешает входящие соединения на порты 80 и 443
- nginx запущен и работает (`sudo systemctl status nginx`)
- В логах nginx нет ошибок (`sudo tail -f /var/log/nginx/error.log`)
- SELinux (если используется) не блокирует соединения

### SSL сертификат не выпускается

Certbot требует чтобы домен был доступен по HTTP (порт 80) для прохождения валидации. Убедитесь что:

- DNS записи указывают на правильный IP адрес
- Firewall разрешает входящие соединения на порт 80
- nginx слушает на порту 80 и отвечает на запросы
- Нет других веб-серверов занимающих порт 80

Вы можете проверить доступность домена командой:

```bash
curl -I http://yourdomain.ru
```

### Проблемы с WebSocket соединениями

Если ваше приложение использует WebSocket (например для real-time функций) убедитесь что в конфигурации nginx присутствуют строки:

```nginx
proxy_set_header Upgrade $http_upgrade;
proxy_set_header Connection 'upgrade';
```

Эти заголовки необходимы для корректной работы WebSocket соединений через прокси.

## Дополнительные рекомендации

### Использование CDN

Для улучшения производительности и снижения нагрузки на сервер рассмотрите возможность использования CDN (Content Delivery Network) вроде Cloudflare. Cloudflare предоставляет бесплатный план который включает:

- Кеширование статических файлов на edge серверах по всему миру
- Защиту от DDoS атак
- Бесплатный SSL сертификат
- Минификацию и оптимизацию контента

Для подключения Cloudflare измените NS (name server) записи вашего домена на reg.ru на серверы имен Cloudflare которые будут указаны при регистрации.

### Мониторинг и логирование

Настройте мониторинг доступности вашего домена используя сервисы вроде UptimeRobot или Pingdom. Это позволит вам получать уведомления если приложение станет недоступным.

Также настройте централизованное логирование для отслеживания ошибок и производительности приложения. Можно использовать стек ELK (Elasticsearch, Logstash, Kibana) или облачные решения вроде Datadog или Sentry.

### Резервное копирование

Обязательно настройте регулярное резервное копирование базы данных и файлов приложения. Для автоматизации можно использовать cron задачи с загрузкой бэкапов в облачное хранилище вроде S3 или Яндекс.Облако.

Пример cron задачи для ежедневного бэкапа MySQL базы данных:

```bash
0 2 * * * mysqldump -u username -p'password' database_name | gzip > /backups/db_$(date +\%Y\%m\%d).sql.gz
```

### Обновление зависимостей

Регулярно обновляйте зависимости проекта для получения исправлений безопасности и новых функций. Используйте команду:

```bash
pnpm update
```

Перед обновлением на production обязательно тестируйте изменения в dev или staging окружении.

## Заключение

Подключение собственного домена к приложению Business Process Builder позволяет создать профессиональный брендированный опыт для ваших пользователей. Следуя данной инструкции вы сможете настроить домен независимо от выбранного способа хостинга приложения.

Если у вас возникли вопросы или проблемы не описанные в данном руководстве обратитесь к документации reg.ru или платформы хостинга которую вы используете.

---

**Документ подготовлен для проекта Business Process Builder**
