# Business Process Builder - TODO

## Базовая настройка
- [x] Настроить схему базы данных
- [x] Создать миграции БД

## Backend API
- [x] Создать API для управления компаниями
- [x] Создать API для голосового интервью
- [x] Интегрировать Whisper API для транскрипции
- [x] Создать API для генерации бизнес-процессов через LLM
- [x] Создать API для работы с комментариями
- [x] Создать API для генерации рекомендаций
- [x] Добавить загрузку аудио файлов в S3

## Frontend - Основные страницы
- [x] Создать главную страницу (лендинг)
- [x] Создать страницу списка компаний
- [x] Создать страницу создания/редактирования компании
- [x] Создать страницу голосового интервью
- [x] Создать страницу просмотра бизнес-процесса
- [x] Создать страницу редактирования процесса
- [x] Создать страницу с рекомендациями

## Frontend - Компоненты
- [x] Компонент записи голоса
- [x] Компонент визуализации BPMN диаграммы
- [x] Компонент списка вопросов интервью
- [x] Компонент отображения этапов процесса
- [ ] Компонент комментариев к процессу
- [x] Компонент карточек рекомендаций

## Функциональность
- [x] Реализовать голосовое интервью с записью
- [x] Реализовать транскрипцию аудио
- [x] Реализовать генерацию бизнес-процесса из интервью
- [x] Реализовать визуализацию процесса (swimlane/BPMN)
- [ ] Реализовать редактирование процесса
- [ ] Реализовать систему комментариев
- [x] Реализовать генерацию рекомендаций по оптимизации
- [ ] Реализовать экспорт процесса в PDF

## Дизайн и UX
- [x] Настроить цветовую схему
- [x] Добавить анимации и переходы
- [x] Оптимизировать для мобильных устройств
- [x] Добавить loading состояния
- [x] Добавить error handling

## Тестирование
- [ ] Протестировать запись голоса
- [ ] Протестировать транскрипцию
- [ ] Протестировать генерацию процесса
- [ ] Протестировать визуализацию
- [ ] Протестировать редактирование
- [ ] Протестировать рекомендации

## Исправления
- [x] Исправить ошибку парсинга JSON при генерации бизнес-процесса
- [x] Добавить обработку ошибок и валидацию JSON ответов от LLM
- [x] Исправить дублирующиеся ключи в компоненте ProcessDiagram

## Новые функции
- [x] Добавить экспорт диаграммы в PNG/SVG
- [x] Реализовать zoom и pan controls для диаграммы
- [x] Добавить фильтры по ролям для диаграммы
- [x] Исправить генерацию рекомендаций
- [x] Исправить ошибку ReactFlowProvider в ProcessDiagram

## Переработка визуализации процесса
- [x] Реализовать swimlane layout (дорожки по ролям)
- [x] Добавить разные формы блоков (прямоугольник, ромб, овал, шестиугольник)
- [x] Реализовать drag-and-drop редактирование
- [x] Добавить функцию удаления блоков
- [x] Исправить переполнение текста в блоках
- [x] Добавить детальное описание МОП (материалы, оборудование, персонал)
- [x] Улучшить читаемость текста на цветных фонах

## Улучшения диаграммы
- [x] Добавить легенду типов блоков
- [x] Исправить отображение связей между блоками
- [x] Исправить отображение рекомендаций

## Переделка визуализации по образцу PDF
- [x] Изменить ориентацию swimlane с горизонтальной на вертикальную (колонки ролей)
- [x] Использовать простые текстовые блоки вместо фигур
- [x] Добавить детальное описание МОП внутри блоков
- [x] Реализовать вертикальное расположение шагов внутри колонок
- [x] Добавить горизонтальные связи между колонками
- [x] Использовать пастельные цвета для колонок ролей
- [x] Добавить нумерацию шагов

## Исправления связей и детализации
- [x] Восстановить отображение связей между блоками
- [x] Углубить детализацию шагов (роль, действия, ИС, время, подэтапы)
- [x] Обновить схему БД для хранения детальной информации
- [x] Обновить промпт LLM для генерации подробных данных
- [x] Добавить отображение информационных систем в блоках
- [x] Добавить подэтапы внутри каждого шага

## Улучшения UI
- [x] Добавить видимые стрелки связей между блоками
- [x] Сделать фильтр по ролям сворачиваемым

## Переделка диаграммы с элементами блок-схем
- [x] Использовать стандартные формы блок-схем (прямоугольник, ромб, овал, параллелограмм)
- [x] Добавить четкие стрелки между всеми элементами процесса
- [x] Реализовать автоматическое позиционирование элементов
- [x] Исправить ошибку undefined в forEach - добавить проверки на существование массивов
- [x] Исправить ошибку с branch.options - добавить проверку на undefined для вложенных массивов

## Исправление отображения деталей в блоках
- [x] Исправить отображение названий шагов (использовать name вместо title)
- [x] Добавить поддержку обоих полей type и shapeType для совместимости
- [x] Увеличить размер блоков для лучшей читаемости (260x120px)
- [x] Добавить отображение описания шага внутри блока (до 120 символов)
- [x] Добавить отображение ответственного лица в блоке
- [x] Добавить отображение времени выполнения в блоке
- [x] Улучшить spacing между элементами внутри блоков

## Расширение функциональности анкетирования
- [x] Создать расширенную систему вопросов (50 вопросов по блокам A-G)
- [x] Реализовать сокращенную версию анкеты (10 самых важных вопросов)
- [x] Добавить выбор варианта анкеты (полная/сокращенная) на странице интервью
- [x] Реализовать сохранение черновиков анкеты
- [x] Добавить возможность возврата к незавершенному интервью
- [x] Реализовать прикрепление документов к компании
- [x] Добавить загрузку документов в S3
- [x] Обновить схему БД для хранения черновиков и документов

## Переделка визуализации процесса по новым правилам
- [x] Обновить промпт генерации процесса согласно правилам из текстового файла
- [ ] Добавить генерацию уровня 0 (крупные этапы процесса)
- [ ] Реализовать детальную таблицу блоков с полями: ID, этап, название, роль, тип узла, вход/выход, действия, система, SLA, связи, документы
- [ ] Добавить генерацию логики ветвлений и условий
- [ ] Добавить привязку к CRM/воронкам и автоматизации
- [ ] Добавить перечень недостающих регламентов и шаблонов
- [x] Переделать визуализацию диаграммы по образцу PDF (горизонтальная swimlane)
- [x] Реализовать отображение крупных этапов сверху диаграммы
- [x] Добавить поддержку типов узлов: Start, Action, Decision, Split, Merge, Event, End
- [x] Реализовать отображение параллельных веток и условий

## Улучшение UX анкетирования (19.11.2025)
- [x] Сделать текст примеров в вопросах копируемым (заменить placeholder на отдельный блок с примером)

## Исправление багов анкетирования (19.11.2025)
- [x] Исправить пропадание текста при заполнении полей анкеты
