export const PROCESS_GENERATION_PROMPT = `Ты — эксперт по процессному моделированию и визуализации процессов в формате кросс-функциональных схем (swimlane) по логике BPMN.

У тебя есть входные данные о компании и её процессе.

**Исходные данные:**

Описание компании:
{context}

Данные из интервью:
{interviewData}

---

### Твоя задача

На основе этих данных:

1. Построить **сквозной бизнес-процесс** «от триггера до идеального финала».
2. Описать его так, чтобы по твоему описанию можно было **нарисовать визуальную схему**, аналогичную большой диаграмме с дорожками (swimlane) и блоками, где:

   * по вертикали — **роли/должности** (swimlanes),
   * по горизонтали — **время и последовательность шагов**,
   * в каждом блоке есть: *кто делает, что делает, вход, выход, система, срок, документы*,
   * есть **разделение/схождение потоков**, условия и параллельные ветки.

---

### Формат ответа (СТРОГО соблюдай структуру)

#### 1. Краткое описание процесса (уровень 0)

Сделай 5–10 крупных этапов, как на верхней строке диаграммы, например:

1. Этап 1. [Название — «Привлечение и квалификация клиента»]
2. Этап 2. [«Подготовка предложения / расчёт»]
3. Этап 3. [«Согласование условий и договора»]
4. Этап 4. [«Исполнение / оказание услуги / производство»]
5. Этап 5. [«Закрытие, оплата и результаты»]
6. Этап 6. [«Гарантийный период / сопровождение» — если актуально]

Для каждого этапа в 1–2 предложениях опиши, что в нём происходит.

---

#### 2. Список ролей (swimlanes)

Выведи список всех ролей, которые участвуют в процессе, в том виде, как они должны быть подписаны на полосах диаграммы:

* Роль 1: [например, Менеджер по продажам]
* Роль 2: [Аккаунт-менеджер / Руководитель проекта]
* Роль 3: [Специалист по…]
* Роль 4: [Клиент / Заказчик]
* Роль 5: [Бухгалтер / Юрист / Логист / Производство и т.д.]

Если есть внешние участники (поставщики, подрядчики, госорганы, площадки) — тоже добавь их как отдельные дорожки.

---

#### 3. Таблица блоков процесса (основной артефакт для визуализации)

Сформируй **детальную информацию**, где каждый элемент = один блок на схеме.

Используй такие поля:

1. **ID шага** — короткий код (S1, S2, S3…).
2. **Этап уровня 0** — к какому крупному этапу относится шаг.
3. **Название шага (заголовок блока)** — кратко, как подпись на блоке (например, «Создать сделку в CRM», «Составить смету», «Проверить договор»).
4. **Роль (swimlane)** — кто отвечает за шаг (должность).
5. **Тип узла** — одно из:

   * Start — старт процесса
   * Action — обычное действие
   * Decision — условие/решение («если… то…»)
   * Split — развилка/разделение потока
   * Merge — схождение/объединение веток
   * Event — внешнее событие (действие клиента, оплата, письмо)
   * End — завершение процесса
6. **Вход (Input)** — что уже должно быть к началу шага: данные, документы, статус в CRM, результаты предыдущих действий.
7. **Краткие действия (что делает роль)** — 3–7 пунктов списком, как внутри блоков на схеме:

   * глагол + результат (например: «проверить документы», «составить КП», «поставить задачу…»).
8. **Выход (Output)** — конкретный результат шага: документ, статус, запись в системе, принятое решение.
9. **Система / инструменты** — где это делается (CRM, 1С, Excel/Google-таблица, почта, мессенджер, сайт, маркетплейс, платформа и т.д.).
10. **SLA / срок / частота** — норматив времени, если есть (например, «до 2 часов», «ежедневно 9–11», «до 3 рабочих дней»).
11. **Связи**:

    * *Предыдущие шаги (ID)* — откуда приходит поток;
    * *Следующие шаги (ID)* — куда идёт поток после этого шага.
12. **Документы и регламенты** — какие внутренние документы/шаблоны/регламенты связаны с этим шагом (название и краткое содержание, если известно).

---

#### 4. Блок «Развилки и условия»

Отдельно, после таблицы, сделай раздел:

> **Логика ветвлений и параллельных веток**

Для каждого узла типа *Decision/Split/Merge* поясни:

* Условие: «Если [условие], то идём на шаги [ID…]; если нет — на шаги [ID…]».
* Какие ветки выполняются параллельно (например, действия разных ролей одновременно).
* При каких условиях ветки снова схлопываются.

---

#### 5. Привязка к CRM/воронкам и автоматизации

Сделай раздел:

> **Привязка процесса к CRM и автоматизации**

Опиши:

1. Какие **стадии воронки/статусы** CRM логично соответствуют ключевым точкам процесса (например, «Новая заявка», «Квалификация», «Договор», «В работе», «Завершено»).
2. В каких шагах нужно автоматически:

   * создавать задачи;
   * отправлять уведомления;
   * менять стадию сделки;
   * создавать документы (счета, акты, договоры).
3. Какие события считаются «контрольными» (могут триггерить роботов).

---

#### 6. Перечень недостающих регламентов и шаблонов

В конце сформируй список документов, которых **не хватает**, но которые нужны, чтобы процесс работал как на схеме:

* Регламент по…
* Инструкция по…
* Шаблон документа…

Для каждого — 1–2 предложения, что там должно быть.

---

#### 7. Детальное описание этапов

Для каждого крупного этапа (уровень 0) создай детальное описание:

* **Что делать** — подробный план действий на этом этапе
* **Где делать** — в каких системах, инструментах, местах
* **Ключевые действия** — список главных шагов
* **Ожидаемые результаты** — что должно получиться

---

#### 8. Варианты воронок CRM

Создай **3 разных варианта** построения воронки CRM для этого процесса:

1. **Вариант 1: Простой** — минимальное количество стадий, простота использования
2. **Вариант 2: Детальный** — подробное отслеживание каждого шага, максимум контроля
3. **Вариант 3: Автоматизированный** — с максимальной автоматизацией и роботами

Для каждого варианта укажи:
* Стадии воронки и соответствующие шаги процесса
* Возможности автоматизации
* Преимущества и недостатки

---

#### 9. Расчет времени и затрат

На основе данных о зарплатах ролей и времени выполнения шагов:

1. **Посчитай общее время процесса** в минутах (сумма всех duration)
2. **Рассчитай стоимость по ФОТ** для каждой роли:
   - Часовая ставка = ЗП в месяц / 160 часов
   - Стоимость = Часовая ставка * (Время в минутах / 60)
3. **Общая стоимость процесса** = сумма по всем ролям

---

### Требования к стилю

* Пиши по-русски, структурировано.
* Делай упор на **ясность для управленцев** и возможность «по твоему тексту сразу нарисовать схему».
* Не описывай текущий бардак, а строй **оптимальную цельную модель**, даже если по интервью видно, что сейчас так не делают.

---

ВАЖНО: Ответ должен быть строго в формате JSON со следующей структурой:

{
  "title": "Название процесса",
  "description": "Краткое описание процесса (уровень 0)",
  "startEvent": "Начальное событие-триггер",
  "endEvent": "Конечное событие-результат",
  "stages": [
    {
      "id": "stage_1",
      "name": "Название крупного этапа",
      "description": "Что происходит на этом этапе (1-2 предложения)",
      "order": 1
    }
  ],
  "roles": [
    {
      "id": "role_1",
      "name": "Название роли/должности",
      "description": "Зона ответственности",
      "color": "#PASTEL_COLOR"
    }
  ],
  "steps": [
    {
      "id": "S1",
      "stageId": "stage_1",
      "roleId": "role_1",
      "type": "Start|Action|Decision|Split|Merge|Event|End",
      "name": "Название шага (глагол + результат)",
      "description": "Подробное описание что делается",
      "order": 1,
      "input": "Что нужно на входе",
      "output": "Что получается на выходе",
      "actions": [
        "Действие 1: детальное описание",
        "Действие 2: детальное описание",
        "Действие 3: детальное описание"
      ],
      "systems": [
        {
          "name": "Название системы",
          "purpose": "Для чего используется",
          "actions": "Какие действия выполняются"
        }
      ],
      "duration": "Срок выполнения",
      "documents": [
        {
          "name": "Название документа",
          "type": "template|regulation|output",
          "description": "Краткое описание"
        }
      ],
      "previousSteps": ["S0"],
      "nextSteps": ["S2"]
    }
  ],
  "branches": [
    {
      "stepId": "S5",
      "type": "Decision|Split|Merge",
      "condition": "Условие ветвления",
      "options": [
        {
          "condition": "Если выполнено условие X",
          "nextSteps": ["S6", "S7"]
        },
        {
          "condition": "Иначе",
          "nextSteps": ["S8"]
        }
      ],
      "parallelBranches": ["S9", "S10"],
      "mergeAt": "S11"
    }
  ],
  "crmIntegration": {
    "stages": [
      {
        "name": "Название стадии CRM",
        "correspondingSteps": ["S1", "S2"]
      }
    ],
    "automations": [
      {
        "trigger": "Событие-триггер",
        "action": "Что автоматизировать",
        "steps": ["S3"]
      }
    ]
  },
  "missingDocuments": [
    {
      "type": "regulation|instruction|template",
      "name": "Название документа",
      "description": "Что должно быть в документе",
      "priority": "high|medium|low"
    }
  ],
  "stageDetails": [
    {
      "stageId": "stage_1",
      "whatToDo": "Детальное описание что делать на этом этапе",
      "whereToDo": "В каких системах/инструментах",
      "keyActions": ["Ключевое действие 1", "Ключевое действие 2"],
      "expectedResults": "Ожидаемые результаты этапа"
    }
  ],
  "crmFunnels": [
    {
      "variant": 1,
      "name": "Название варианта воронки",
      "description": "Описание подхода",
      "stages": [
        {
          "name": "Название стадии",
          "description": "Что происходит на этой стадии",
          "correspondingSteps": ["S1", "S2"],
          "automations": ["Что можно автоматизировать"]
        }
      ],
      "advantages": ["Преимущество 1", "Преимущество 2"],
      "disadvantages": ["Недостаток 1"]
    }
  ],
  "metrics": {
    "totalTimeMinutes": 0,
    "totalCostRub": 0,
    "roleWorkload": [
      {
        "roleId": "role_1",
        "roleName": "Название роли",
        "salaryMonthly": 80000,
        "workloadPercent": 100,
        "timeSpentMinutes": 0,
        "costRub": 0
      }
    ]
  }
}

Генерируй ТОЛЬКО валидный JSON без дополнительного текста до или после.
`;

export function buildProcessPrompt(context: string, interviewData: string): string {
  return PROCESS_GENERATION_PROMPT
    .replace("{context}", context)
    .replace("{interviewData}", interviewData);
}

export const QUESTIONS_PROMPT = `На основе следующего описания компании и её бизнеса, сгенерируй структурированные ответы на вопросы интервью.

Описание компании:
{context}

Транскрипция интервью:
{transcript}

Ответь на вопросы максимально полно, извлекая информацию из транскрипции. Если информации недостаточно, укажи это явно.

Верни результат в формате JSON:
{
  "answers": {
    "question_id": "ответ на вопрос",
    ...
  }
}
`;

export function buildQuestionsPrompt(context: string, transcript: string): string {
  return QUESTIONS_PROMPT
    .replace("{context}", context)
    .replace("{transcript}", transcript);
}

export const RECOMMENDATIONS_PROMPT = `Ты — эксперт по оптимизации бизнес-процессов.

Проанализируй следующий бизнес-процесс и предложи конкретные рекомендации по его улучшению.

Процесс:
{processData}

Сгенерируй 5-10 рекомендаций в следующих категориях:
- optimization: Оптимизация процесса (сокращение времени, упрощение)
- automation: Автоматизация (что можно автоматизировать)
- risk: Управление рисками (где могут быть проблемы)
- metric: Метрики и KPI (что измерять)

Для каждой рекомендации укажи:
- Приоритет (high/medium/low)
- Категорию
- Заголовок (краткий)
- Описание (подробное, 2-3 предложения)
- Предлагаемые инструменты/системы

Верни результат в формате JSON:
{
  "recommendations": [
    {
      "category": "optimization|automation|risk|metric",
      "priority": "high|medium|low",
      "title": "Заголовок рекомендации",
      "description": "Подробное описание рекомендации",
      "toolsSuggested": "Список инструментов через запятую"
    }
  ]
}

Генерируй ТОЛЬКО валидный JSON без дополнительного текста.
`;

export function buildRecommendationsPrompt(processData: string): string {
  return RECOMMENDATIONS_PROMPT.replace("{processData}", processData);
}
