export const PROCESS_GENERATION_PROMPT = `
У тебя есть входные данные о компании и её процессе.

**Исходные данные:**

Описание компании:
{context}

Данные из интервью:
{interviewData}

---

### Твоя задача

На основе этих данных построить **сквозной бизнес-процесс** «от триггера до идеального финала».

---

### Формат ответа (СТРОГО соблюдай структуру)

#### 1. Краткое описание процесса (уровень 0)

Сделай 5–7 крупных этапов, например:
1. Этап 1. [Название — «Привлечение и квалификация клиента»]
2. Этап 2. [«Подготовка предложения / расчёт»]
3. Этап 3. [«Согласование условий и договора»]
4. Этап 4. [«Исполнение / оказание услуги / производство»]
5. Этап 5. [«Закрытие, оплата и результаты»]

Для каждого этапа в 1–2 предложениях опиши, что в нём происходит.

---

#### 2. Список ролей (swimlanes)

Выведи список всех ролей, которые участвуют в процессе:
* Роль 1: [например, Менеджер по продажам]
* Роль 2: [Аккаунт-менеджер / Руководитель проекта]
* Роль 3: [Специалист по…]
* Роль 4: [Клиент / Заказчик]
* Роль 5: [Бухгалтер / Юрист / Логист / Производство и т.д.]

---

#### 3. Таблица блоков процесса

Сформируй **детальную информацию**, где каждый элемент = один блок на схеме.

Используй такие поля:

1. **ID шага** — короткий код (S1, S2, S3…).
2. **Этап уровня 0** — к какому крупному этапу относится шаг.
3. **Название шага** — кратко, как подпись на блоке.
4. **Роль** — кто отвечает за шаг.
5. **Тип узла** — Start, Action, Decision, Split, Merge, Event, End
6. **Вход** — что уже должно быть к началу шага.
7. **Действия** — 3–5 пунктов списком что делает роль.
8. **Выход** — конкретный результат шага.
9. **Система / инструменты** — где это делается.
10. **Связи** — предыдущие и следующие шаги (ID).

---

#### 4. Блок «Развилки и условия»

Для каждого узла типа *Decision/Split/Merge* поясни:
* Условие: «Если [условие], то идём на шаги [ID…]; если нет — на шаги [ID…]».
* Какие ветки выполняются параллельно.

---

#### 5. Привязка к CRM

Опиши:
1. Какие **стадии воронки/статусы** CRM логично соответствуют ключевым точкам процесса.
2. В каких шагах нужно автоматически создавать задачи, отправлять уведомления, менять стадию сделки.

---

#### 6. Перечень недостающих регламентов

Сформируй список документов, которых **не хватает**:
* Регламент по…
* Инструкция по…
* Шаблон документа…

---

### Требования к стилю

* Пиши по-русски, структурировано.
* Делай упор на **ясность для управленцев**.
* Строй **оптимальную цельную модель**, даже если по интервью видно, что сейчас так не делают.

---

ВАЖНО: Ответ должен быть строго в формате JSON со следующей структурой:

{
  "title": "Название процесса",
  "description": "Краткое описание процесса",
  "startEvent": "Начальное событие-триггер",
  "endEvent": "Конечное событие-результат",
  "stages": [
    {
      "id": "stage_1",
      "name": "Название крупного этапа",
      "description": "Что происходит на этом этапе (1-2 предложения)",
      "order": 1
    }
  ],
  "roles": [
    {
      "id": "role_1",
      "name": "Название роли/должности",
      "description": "Зона ответственности",
      "color": "#PASTEL_COLOR"
    }
  ],
  "steps": [
    {
      "id": "S1",
      "stageId": "stage_1",
      "roleId": "role_1",
      "type": "Start|Action|Decision|Split|Merge|Event|End",
      "name": "Название шага",
      "description": "Подробное описание",
      "order": 1,
      "input": "Что нужно на входе",
      "output": "Что получается на выходе",
      "actions": ["Действие 1", "Действие 2", "Действие 3"],
      "systems": ["Название системы 1", "Название системы 2"],
      "duration": "Срок выполнения",
      "previousSteps": ["S0"],
      "nextSteps": ["S2"]
    }
  ],
  "branches": [
    {
      "stepId": "S5",
      "type": "Decision|Split|Merge",
      "condition": "Условие ветвления",
      "options": [
        {
          "condition": "Если выполнено условие X",
          "nextSteps": ["S6", "S7"]
        }
      ]
    }
  ],
  "crmIntegration": {
    "stages": [
      {
        "name": "Название стадии CRM",
        "correspondingSteps": ["S1", "S2"]
      }
    ],
    "automations": [
      {
        "trigger": "Событие-триггер",
        "action": "Что автоматизировать",
        "steps": ["S3"]
      }
    ]
  },
  "missingDocuments": [
    {
      "type": "regulation|instruction|template",
      "name": "Название документа",
      "description": "Что должно быть в документе",
      "priority": "high|medium|low"
    }
  ]
}

Генерируй ТОЛЬКО валидный JSON без дополнительного текста до или после.
`;

export function buildProcessPrompt(context: string, interviewData: string): string {
  return PROCESS_GENERATION_PROMPT
    .replace("{context}", context)
    .replace("{interviewData}", interviewData);
}

export const QUESTIONS_PROMPT = `На основе следующего описания компании и её бизнеса, сгенерируй структурированные ответы на вопросы интервью.

Описание компании:
{context}

Транскрипция интервью:
{transcript}

Ответь на вопросы максимально полно, извлекая информацию из транскрипции. Если информации недостаточно, укажи это явно.

Верни результат в формате JSON:
{
  "answers": {
    "question_id": "ответ на вопрос",
    ...
  }
}
`;

export function buildQuestionsPrompt(context: string, transcript: string): string {
  return QUESTIONS_PROMPT
    .replace("{context}", context)
    .replace("{transcript}", transcript);
}

export const RECOMMENDATIONS_PROMPT = `Ты — эксперт по оптимизации бизнес-процессов.

Проанализируй следующий бизнес-процесс и предложи конкретные рекомендации по его улучшению.

Процесс:
{processData}

Сгенерируй 5-10 рекомендаций в следующих категориях:
- optimization: Оптимизация процесса (сокращение времени, упрощение)
- automation: Автоматизация (что можно автоматизировать)
- risk: Управление рисками (где могут быть проблемы)
- metric: Метрики и KPI (что измерять)

Для каждой рекомендации укажи:
- Приоритет (high/medium/low)
- Категорию
- Заголовок (краткий)
- Описание (подробное, 2-3 предложения)
- Предлагаемые инструменты/системы

Верни результат в формате JSON:
{
  "recommendations": [
    {
      "category": "optimization|automation|risk|metric",
      "priority": "high|medium|low",
      "title": "Заголовок рекомендации",
      "description": "Подробное описание рекомендации",
      "toolsSuggested": "Список инструментов через запятую"
    }
  ]
}

Генерируй ТОЛЬКО валидный JSON без дополнительного текста.
`;

export function buildRecommendationsPrompt(processData: string): string {
  return RECOMMENDATIONS_PROMPT.replace("{processData}", processData);
}
